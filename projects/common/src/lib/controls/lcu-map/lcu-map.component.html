<div id="map-section">
  <div class="icon-list" fxLayout="row" fxLayout.lt-sm="column" fxLayoutAlign="center center"
    fxLayoutAlign.lt-sm="end center">
    <!-- <div class="top-icon-set" fxLayoutAlign="end start">
      <lcu-legend class="legend" [current-map-model]="_currentMapModel"
        [currently-active-locations]="CurrentlyActiveLocations" [get-legend-locations]="_savedLegendLocations"
        [currently-active-layers]="CurrentlyActiveLayers" (pan)="PanningTo($event)"
        (display-basic-info)="DisplayMarkerInfo($event)" (save-legend-locations)="SaveLegendLocations($event)">
      </lcu-legend>
    </div> -->
    <!-- fxLayoutAlign.lt-sm="start center" -->
    <div class="bottom-icon-set" fxLayoutAlign="center center" fxLayoutAlign.lt-sm="end center">

      <div class="center-buttons mat-icon-divs">
        <mat-icon class="center-buttons" (click)="ShowLocationSearchBarClicked()">search</mat-icon>
      </div>

      <div class="center-buttons mat-icon-divs">
        <mat-icon class="center-buttons" (click)="ActivateSaveMapDialog(map)">add</mat-icon>
      </div>

      <div class="center-buttons mat-icon-divs">
        <mat-icon class="center-buttons" (click)="ShowLayersDropdown = !ShowLayersDropdown">layers
        </mat-icon>
        <!-- the menu for the map layers button -->
        <div id="layer-menu" *ngIf="ShowLayersDropdown">
          <mat-radio-group [(ngModel)]="CurrentMapViewType">
            <mat-radio-button (click)="$event.stopPropagation()" *ngFor="let view of MapViewTypes" [value]="view.value">
              {{view.display}}</mat-radio-button>
          </mat-radio-group>
          <mat-divider></mat-divider>
          <mat-checkbox (click)="$event.stopPropagation()" (change)="LayerClicked($event)" [checked]="PrimaryChecked"
            matTooltip="The markers on your main map... Add markers to this map to be saved."
            matTooltipPosition="before">
            {{_currentMapModel.title}} (Primary)</mat-checkbox>
          <mat-divider></mat-divider>
          <mat-checkbox id="map_id_{{map.id}}" (click)="$event.stopPropagation()" [checked]="SecondaryChecked"
            (change)="LayerClicked($event, map)" *ngFor="let map of SecondaryMaps">{{ map.title }}
          </mat-checkbox>
        </div>
      </div>
    </div>

    <div class="top-icon-set" fxLayoutAlign="end start">
      <lcu-legend class="legend" [current-map-model]="_currentMapModel"
        [currently-active-locations]="CurrentlyActiveLocations" [get-legend-locations]="_savedLegendLocations"
        [currently-active-layers]="CurrentlyActiveLayers" (pan)="PanningTo($event)"
        (display-basic-info)="DisplayMarkerInfo($event)" (save-legend-locations)="SaveLegendLocations($event)">
      </lcu-legend>
    </div>
  </div>

  <!-- the search bar -->
  <div [hidden]="!ShowSearchBar" id="search-bar">
    <!-- the native Google API for POI location search -->
    <div [hidden]="SearchMethod !== 'Google Locations'">
      <input placeholder="search for Google location" autocorrect="off" autocapitalize="off" spellcheck="off"
        type="text" #search [formControl]="SearchControl">
    </div>
    <!-- the custom marker search bar -->
    <form [hidden]="SearchMethod !== 'Custom Markers'">
      <input type="text" placeholder="search for custom location" aria-label="Assignee"
        [formControl]="CustomLocationControl" [matAutocomplete]="auto">
      <mat-autocomplete #auto="matAutocomplete" [displayWith]="DisplayFn">
        <mat-option (click)="DropdownItemChosen(location)" *ngFor="let location of FilteredLocations | async"
          [value]="location">
          <span><img class="dropdown-marker-image" src="{{location.iconImageObject.url}}"></span>
          <span class="dropdown-marker-title-text">{{ location.title }}</span>&nbsp;
          <span class="dropdown-marker-location-text">{{ location.town }}, {{ location.country }}</span>
        </mat-option>
      </mat-autocomplete>
    </form>
    <!-- the radio buttons for search type (custom markers vs Google POI locations) -->
    <div class="search-method-radio-group">
      <mat-radio-group [(ngModel)]="SearchMethod">
        <mat-radio-button *ngFor="let method of SearchMethods" [value]="method">
          {{method}}
        </mat-radio-button>
      </mat-radio-group>
    </div>
  </div> <!-- END search bar section -->

  <!-- the map -->
  <div class="agm-map-container">
  <agm-map class="map" [streetViewControl]="false" (mapReady)="OnMapReady($event)" [mapTypeId]="CurrentMapViewType"
  (boundsChange)="BoundsChange($event)" #map [latitude]="_currentMapModel.origin.lat" [zoomControl]="true" [zoomControlOptions]="ZoomOptions"
    [longitude]="_currentMapModel.origin.lng" [title]="_currentMapModel.title" [zoom]="_currentMapModel.zoom"
    (mapDblClick)="OnMapDoubleClicked($event)" (mapClick)="OnChoseLocation($event)" [usePanning]="true">
    <div id="markers" *ngFor="let marker of CurrentlyActiveLocations">
      <agm-marker [latitude]="marker.lat" [longitude]="marker.lng" [title]="marker.title"
        [iconUrl]="marker.iconImageObject" (markerClick)="DisplayMarkerInfo(marker)">
      </agm-marker>
    </div>
  </agm-map>
</div>
  <!-- Footer Menu to display Marker Info -->
  <div class="footer" *ngIf="DisplayFooter && IsMobile">
    <lcu-info-footer *ngIf="MarkerData" fxLayout="column" fxLayoutAlign="space-around stretch" [MarkerData]="MarkerData"
      (show-footer)=ShowFooter($event) (new-map-marker)=SetNewMapMarker($event)>
    </lcu-info-footer>
  </div>
</div>