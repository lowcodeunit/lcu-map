<div id="map-section">
  <div class="icon-list" fxLayout="row" fxLayout.lt-sm="column" fxLayoutAlign="center center"
    fxLayoutAlign.lt-sm="end center">
    <div class="bottom-icon-set" fxLayoutAlign="center center" fxLayoutAlign.lt-sm="end center">

      <div class="center-buttons mat-icon-divs">
        <mat-icon class="center-buttons search-bar-element" (click)="ShowLocationSearchBarClicked()">search</mat-icon>
      </div>

      <div class="center-buttons mat-icon-divs">
        <mat-icon class="center-buttons" (click)="ActivateSaveMapDialog(map)">add</mat-icon>
      </div>

      <div class="center-buttons mat-icon-divs">
        <mat-icon class="center-buttons layer-element" (click)="ShowLayersDropdown = !ShowLayersDropdown">layers
        </mat-icon>
        <!-- the menu for the map layers button -->
        <div id="layer-menu" *ngIf="ShowLayersDropdown">
          <mat-radio-group [(ngModel)]="CurrentMapViewType">
            <mat-radio-button (click)="$event.stopPropagation()" *ngFor="let view of MapViewTypes" [value]="view.value">
              {{view.display}}</mat-radio-button>
          </mat-radio-group>
          <mat-divider></mat-divider>
          <!-- <mat-checkbox (click)="$event.stopPropagation()" (change)="LayerClicked($event)" [checked]="PrimaryChecked"
            matTooltip="The markers on your main map... Add markers to this map to be saved."
            matTooltipPosition="before">
            {{_currentMapModel.Title}} (Primary)</mat-checkbox> -->
          <mat-divider></mat-divider>
          <mat-checkbox *ngFor="let layer of _userLayers" [checked]="_selectedUserLayers.includes(layer.ID)"
            (click)="$event.stopPropagation()" (change)="LayerClicked($event, layer)">{{ layer.Title }}</mat-checkbox>
        </div>
      </div>
      <div class="center-buttons mat-icon-divs">
        <mat-icon class="center-buttons" matTooltip="Share">share</mat-icon>
      </div>
    </div>

    <div class="top-icon-set" fxLayoutAlign="end start">
      <lcu-legend class="legend" [current-map-model]="_currentMapModel"
        [currently-active-locations]="_visibleLocationsMasterList"
        [selected-location]="SelectedLocation"
        [currently-active-layers]="GetSelectedUserLayers()" (pan)="PanningTo($event)"
        (display-basic-info)="DisplayMarkerInfo($event)" (save-legend-locations)="SaveLegendLocations($event)">
      </lcu-legend>
    </div>
  </div>

  <!-- the search bar -->
  <div [hidden]="!ShowSearchBar" id="search-bar" class="search-bar-element">
    <!-- the native Google API for POI location search -->
    <div [hidden]="SearchMethod !== 'Google'" class="search-bar-element">
      <input placeholder="search for Google locations" autocorrect="off" autocapitalize="off" spellcheck="off"
        type="text" #search [formControl]="SearchControl" class="search-bar-element">
    </div>
    <!-- the custom marker search bar -->
    <form [hidden]="SearchMethod !== 'ambl_on'" class="search-bar-element">
      <input type="text" (keyup)="CustomSearchInputChange($event)" placeholder="search for ambl_on locations" aria-label="Assignee"
        [formControl]="CustomLocationControl" [matAutocomplete]="auto" class="search-bar-element">
      <mat-autocomplete #auto="matAutocomplete" [displayWith]="DisplayFn" class="search-bar-element">
        <mat-option (click)="DropdownItemChosen(location)" *ngFor="let location of FilteredLocations | async"
          [value]="location" class="search-bar-element">
          <span><img class="dropdown-marker-image search-bar-element" src="{{location.IconImageObject.Url}}"></span>
          <span class="dropdown-marker-title-text search-bar-element">{{ location.Title }}</span>&nbsp;
          <span class="dropdown-marker-location-text search-bar-element">{{ location.Town }}, {{ location.Country }}</span>
        </mat-option>
      </mat-autocomplete>
    </form>
    <!-- the radio buttons for search type (custom markers vs Google POI locations) -->
    <div class="search-method-radio-group search-bar-element">
      <mat-radio-group [(ngModel)]="SearchMethod" class="search-bar-element">
        <mat-radio-button *ngFor="let method of SearchMethods" [value]="method" class="search-bar-element">
          {{method}}
        </mat-radio-button>
      </mat-radio-group>
    </div>
  </div> <!-- END search bar section -->

  <!-- the map -->
  <div class="agm-map-container">
    <agm-map [minZoom]="3" class="map" [streetViewControl]="false" (mapReady)="OnMapReady($event)" [mapTypeId]="CurrentMapViewType"
      (boundsChange)="BoundsChange($event)" #map [latitude]="_currentMapModel.Latitude" [zoomControl]="true"
      [zoomControlOptions]="ZoomOptions" [longitude]="_currentMapModel.Longitude" [title]="_currentMapModel.Title"
      [zoom]="_currentMapModel.Zoom" (mapDblClick)="OnMapDoubleClicked($event)" (mapClick)="OnChoseLocation($event)"
      [usePanning]="true">
      <!-- <div id="markers" *ngFor="let marker of CurrentlyActiveLocations"> -->
      <div id="markers" *ngFor="let marker of _visibleLocationsMasterList">
        <agm-marker [latitude]="marker.Latitude" [longitude]="marker.Longitude" [title]="marker.Title"
          [iconUrl]="marker.IconImageObject" (markerClick)="DisplayMarkerInfo(marker)">
        </agm-marker>
      </div>

      <agm-marker *ngIf="IconIsHighlighted" id="highlighted-marker" [iconUrl]="'./assets/ambl_glow.PNG'" [opacity]=".5"
        [latitude]="_currentMapModel.origin.Latitude" [longitude]="_currentMapModel.origin.Longitude">

      </agm-marker>
    </agm-map>
  </div>
  <!-- Footer Menu to display Marker Info -->
  <div class="footer" *ngIf="DisplayFooter && IsMobile">
    <lcu-info-footer *ngIf="MarkerData" fxLayout="column" fxLayoutAlign="space-around stretch" [MarkerData]="MarkerData"
      (show-footer)=ShowFooter($event) (new-map-marker)=SetNewMapMarker($event)>
    </lcu-info-footer>
  </div>
</div>